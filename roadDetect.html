<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SustainX ‚Äî Road Crack Hunter üïµÔ∏è</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;}
:root{
  --neon:#00ffcc;--neon2:#ff6bff;--neon3:#ffbe00;--red:#ff3355;
  --bg:#07080f;--card:rgba(255,255,255,0.04);
  --text:#eef2ff;--dim:#7a8aaa;
  --orange:#ff8c42;--green:#00e5a0;--yellow:#ffdf00;--blue:#00b8ff;
}
html{scroll-behavior:smooth;}
body{font-family:'Outfit',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;cursor:crosshair;}
.bg-grid{position:fixed;inset:0;z-index:0;pointer-events:none;background-image:linear-gradient(rgba(0,255,204,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,204,0.025) 1px,transparent 1px);background-size:50px 50px;animation:gridPan 25s linear infinite;}
@keyframes gridPan{0%{background-position:0 0}100%{background-position:50px 50px}}
.bg-blob{position:fixed;pointer-events:none;z-index:0;border-radius:50%;filter:blur(110px);opacity:0.1;}
.blob1{width:700px;height:700px;background:var(--neon);top:-250px;left:-250px;animation:bf 18s ease-in-out infinite;}
.blob2{width:600px;height:600px;background:var(--neon2);bottom:-250px;right:-200px;animation:bf 22s ease-in-out infinite reverse;}
.blob3{width:400px;height:400px;background:var(--neon3);top:50%;left:45%;animation:bf 14s ease-in-out infinite 4s;}
@keyframes bf{0%,100%{transform:translate(0,0)}50%{transform:translate(40px,-35px)}}
nav{position:fixed;top:0;left:0;right:0;z-index:200;padding:0.9rem 2.5rem;backdrop-filter:blur(30px);background:rgba(7,8,15,0.85);border-bottom:1px solid rgba(0,255,204,0.1);display:flex;align-items:center;gap:1.2rem;}
.back-btn{background:rgba(0,255,204,0.08);border:1px solid rgba(0,255,204,0.2);color:var(--neon);padding:0.45rem 1.1rem;border-radius:8px;cursor:pointer;font-family:'Outfit',sans-serif;font-size:0.85rem;text-decoration:none;display:flex;align-items:center;gap:0.5rem;transition:all 0.3s;}
.back-btn:hover{background:rgba(0,255,204,0.15);}
.nav-logo{font-family:'Orbitron',monospace;font-size:1rem;font-weight:900;background:linear-gradient(135deg,var(--neon),var(--neon2));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.nav-right{margin-left:auto;display:flex;gap:0.8rem;align-items:center;}
.nbadge{display:flex;align-items:center;gap:0.45rem;padding:0.3rem 0.85rem;border-radius:20px;font-size:0.78rem;font-family:'JetBrains Mono',monospace;}
.nbadge.live{background:rgba(255,51,85,0.1);border:1px solid rgba(255,51,85,0.3);color:var(--red);}
.nbadge.xp{background:rgba(255,190,0,0.1);border:1px solid rgba(255,190,0,0.3);color:var(--neon3);font-weight:700;}
.nbadge.wth{background:rgba(0,184,255,0.1);border:1px solid rgba(0,184,255,0.25);color:var(--blue);cursor:pointer;transition:all 0.3s;}
.nbadge.wth:hover{background:rgba(0,184,255,0.18);}
.live-dot{width:6px;height:6px;background:var(--red);border-radius:50%;animation:blink 1s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.2}}
.hero{position:relative;z-index:1;padding:90px 0 2rem;text-align:center;width:100%;}
.hero-badge{display:inline-flex;align-items:center;gap:0.6rem;background:rgba(255,190,0,0.1);border:1px solid rgba(255,190,0,0.22);padding:0.4rem 1.1rem;border-radius:30px;font-size:0.75rem;color:var(--neon3);margin-bottom:1.2rem;letter-spacing:0.05em;font-family:'Orbitron',monospace;animation:pg 2.5s ease-in-out infinite;}
@keyframes pg{0%,100%{box-shadow:0 0 0 rgba(255,190,0,0)}50%{box-shadow:0 0 18px rgba(255,190,0,0.2)}}
.hero h1{font-family:'Orbitron',monospace;font-size:clamp(2.2rem,5vw,4rem);font-weight:900;line-height:1.05;margin-bottom:0.8rem;letter-spacing:0.02em;text-transform:uppercase;}
.g1{background:linear-gradient(135deg,var(--neon),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.g2{background:linear-gradient(135deg,var(--orange),var(--red));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hero-sub{color:var(--dim);font-size:1rem;max-width:540px;margin:0 auto 1.8rem;line-height:1.7;}
.steps-row{display:flex;justify-content:center;align-items:center;gap:0.3rem;margin-bottom:2rem;flex-wrap:wrap;padding:0 1rem;}
.step-chip{display:flex;align-items:center;gap:0.5rem;padding:0.5rem 1.1rem;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.03);font-size:0.82rem;transition:all 0.4s;}
.step-chip.active{border-color:var(--neon);background:rgba(0,255,204,0.08);color:var(--neon);}
.step-chip.done{border-color:rgba(0,229,160,0.35);color:var(--green);}
.step-num{width:20px;height:20px;border-radius:50%;border:2px solid currentColor;display:flex;align-items:center;justify-content:center;font-family:'JetBrains Mono',monospace;font-size:0.65rem;font-weight:700;}
.step-arrow{color:var(--dim);font-size:0.75rem;}
.page-body{position:relative;z-index:1;display:grid;grid-template-columns:310px 1fr 350px;gap:1.5rem;padding:0 1.5rem 6rem;width:100%;max-width:1600px;margin:0 auto;}
.col-left,.col-center,.col-right{display:flex;flex-direction:column;gap:1.5rem;}
.panel{background:var(--card);border:1px solid rgba(255,255,255,0.06);border-radius:20px;padding:1.4rem;}
.panel-title{font-family:'JetBrains Mono',monospace;font-size:0.72rem;color:var(--dim);text-transform:uppercase;letter-spacing:0.1em;margin-bottom:1.2rem;display:flex;align-items:center;gap:0.5rem;}

/* WEATHER */
.weather-card{background:linear-gradient(135deg,rgba(0,184,255,0.09),rgba(0,229,160,0.05));border:1px solid rgba(0,184,255,0.18);border-radius:20px;padding:1.4rem;position:relative;overflow:hidden;}
.weather-card::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;background:radial-gradient(circle,rgba(0,184,255,0.14),transparent 70%);pointer-events:none;}
.weather-main{display:flex;align-items:center;gap:1rem;margin-bottom:0.9rem;}
.weather-icon{font-size:2.8rem;filter:drop-shadow(0 0 12px rgba(0,184,255,0.4));}
.weather-temp{font-family:'Orbitron',monospace;font-size:2rem;font-weight:900;color:var(--blue);}
.weather-city{font-size:0.9rem;font-weight:600;}
.weather-desc{font-size:0.78rem;color:var(--dim);margin-top:0.15rem;}
.weather-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:0.5rem;margin-top:0.4rem;}
.w-item{background:rgba(0,184,255,0.06);border:1px solid rgba(0,184,255,0.1);border-radius:10px;padding:0.5rem;text-align:center;}
.w-val{font-family:'JetBrains Mono',monospace;font-size:0.85rem;font-weight:700;color:var(--blue);}
.w-lbl{font-size:0.62rem;color:var(--dim);margin-top:0.15rem;text-transform:uppercase;letter-spacing:0.04em;}
.weather-impact{margin-top:0.7rem;padding:0.65rem;border-radius:10px;background:rgba(255,190,0,0.07);border:1px solid rgba(255,190,0,0.16);font-size:0.78rem;color:var(--neon3);display:flex;align-items:flex-start;gap:0.5rem;line-height:1.5;}

/* SCORE */
.score-card{background:linear-gradient(135deg,rgba(255,140,66,0.08),rgba(255,51,85,0.05));border:1px solid rgba(255,140,66,0.18);border-radius:20px;padding:1.5rem;text-align:center;}
.score-ring-wrap{width:130px;height:130px;position:relative;margin:0 auto 0.8rem;}
.score-ring-wrap svg{transform:rotate(-90deg);}
#score-circle{transition:stroke-dashoffset 1.5s cubic-bezier(0.4,0,0.2,1);stroke-dasharray:345;stroke-dashoffset:345;}
.score-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;}
#score-num{font-family:'Orbitron',monospace;font-size:2.2rem;font-weight:900;line-height:1;background:linear-gradient(135deg,var(--orange),var(--red));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.score-max{font-size:0.78rem;color:var(--dim);font-family:'JetBrains Mono',monospace;}
.score-verdict{font-size:0.88rem;font-weight:600;margin-bottom:0.5rem;}
.urgency-pill{display:inline-block;padding:0.32rem 1rem;border-radius:20px;font-size:0.73rem;font-family:'JetBrains Mono',monospace;border:1px solid rgba(122,138,170,0.3);background:rgba(122,138,170,0.1);color:var(--dim);}

/* UPLOAD */
.drop-zone{border:2px dashed rgba(0,255,204,0.22);border-radius:20px;padding:2.5rem 1.5rem;text-align:center;cursor:pointer;background:rgba(0,255,204,0.02);transition:all 0.4s;position:relative;overflow:hidden;}
.drop-zone:hover,.drop-zone.over{border-color:var(--neon);background:rgba(0,255,204,0.04);box-shadow:0 0 50px rgba(0,255,204,0.08);}
.drop-icon{font-size:3.5rem;display:block;margin-bottom:0.8rem;filter:drop-shadow(0 0 18px rgba(0,255,204,0.35));animation:bob 2.5s ease-in-out infinite;}
@keyframes bob{0%,100%{transform:translateY(0)}50%{transform:translateY(-7px)}}
.drop-zone h3{font-size:1.2rem;font-weight:600;margin-bottom:0.4rem;}
.drop-zone p{color:var(--dim);font-size:0.85rem;margin-bottom:1.2rem;}
.upload-btns{display:flex;gap:0.8rem;justify-content:center;flex-wrap:wrap;}
.btn-up{background:linear-gradient(135deg,var(--neon),var(--blue));color:#07080f;border:none;padding:0.65rem 1.6rem;border-radius:10px;font-family:'Outfit',sans-serif;font-size:0.9rem;font-weight:700;cursor:pointer;transition:all 0.3s;box-shadow:0 5px 20px rgba(0,255,204,0.25);}
.btn-up:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,255,204,0.4);}
.btn-cam{background:rgba(255,107,255,0.1);border:1px solid rgba(255,107,255,0.25);color:var(--neon2);padding:0.65rem 1.3rem;border-radius:10px;font-family:'Outfit',sans-serif;font-size:0.9rem;font-weight:600;cursor:pointer;transition:all 0.3s;}
.btn-cam:hover{background:rgba(255,107,255,0.15);}
#preview-wrap{display:none;position:relative;border-radius:18px;overflow:hidden;background:#0a0c14;border:1px solid rgba(255,255,255,0.07);}
#preview-img{width:100%;max-height:420px;object-fit:cover;display:block;}
.preview-toolbar{position:absolute;top:10px;right:10px;display:flex;gap:0.4rem;z-index:10;}
.tool-btn{width:34px;height:34px;border-radius:8px;background:rgba(7,8,15,0.85);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:0.95rem;transition:all 0.3s;}
.tool-btn:hover{border-color:var(--neon);}

/* SCAN */
#scan-overlay{display:none;position:absolute;inset:0;z-index:20;pointer-events:none;}
.scan-line-el{position:absolute;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(0,255,204,0.9) 30%,white 50%,rgba(0,255,204,0.9) 70%,transparent);box-shadow:0 0 25px rgba(0,255,204,0.7);animation:scanAnim 1.8s ease-in-out infinite;}
@keyframes scanAnim{0%{top:0;opacity:0}5%{opacity:1}90%{opacity:1}100%{top:100%;opacity:0}}
.hud-c{position:absolute;width:28px;height:28px;border-color:var(--neon);border-style:solid;border-width:0;opacity:0.75;}
.hud-c.tl{top:10px;left:10px;border-top-width:3px;border-left-width:3px;border-radius:4px 0 0 0;}
.hud-c.tr{top:10px;right:10px;border-top-width:3px;border-right-width:3px;border-radius:0 4px 0 0;}
.hud-c.bl{bottom:10px;left:10px;border-bottom-width:3px;border-left-width:3px;border-radius:0 0 0 4px;}
.hud-c.br{bottom:10px;right:10px;border-bottom-width:3px;border-right-width:3px;border-radius:0 0 4px 0;}
.grid-ovl{position:absolute;inset:0;background-image:linear-gradient(rgba(0,255,204,0.05) 1px,transparent 1px),linear-gradient(90deg,rgba(0,255,204,0.05) 1px,transparent 1px);background-size:28px 28px;animation:gf 0.7s step-end infinite;}
@keyframes gf{0%,100%{opacity:1}50%{opacity:0.3}}
.scan-status{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(7,8,15,0.92);border:1px solid var(--neon);border-radius:10px;padding:0.7rem 1.8rem;font-family:'JetBrains Mono',monospace;font-size:0.85rem;color:var(--neon);animation:sf 0.5s ease-in-out infinite alternate;white-space:nowrap;}
@keyframes sf{0%{opacity:1}100%{opacity:0.55}}
.detect-box{position:absolute;border:2px solid;border-radius:4px;pointer-events:none;animation:br 0.4s ease-out both;}
@keyframes br{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
.detect-label{position:absolute;top:-24px;left:-1px;padding:2px 7px;border-radius:4px 4px 4px 0;font-family:'JetBrains Mono',monospace;font-size:0.65rem;font-weight:700;white-space:nowrap;}
.detect-conf{position:absolute;bottom:-18px;right:-1px;font-family:'JetBrains Mono',monospace;font-size:0.6rem;color:rgba(255,255,255,0.65);}
.detect-pulse{position:absolute;inset:-4px;border-radius:6px;border:2px solid;animation:dp 1.5s ease-out forwards;}
@keyframes dp{0%{opacity:0.7;transform:scale(1)}100%{opacity:0;transform:scale(1.25)}}

/* ANALYZE BTN */
#analyze-btn{display:none;width:100%;padding:1.1rem;background:linear-gradient(135deg,var(--orange),var(--red));border:none;border-radius:14px;color:white;font-family:'Orbitron',monospace;font-size:0.9rem;font-weight:700;cursor:pointer;letter-spacing:0.05em;text-transform:uppercase;transition:all 0.3s;box-shadow:0 8px 35px rgba(255,68,102,0.28);position:relative;overflow:hidden;}
#analyze-btn::before{content:'';position:absolute;top:-50%;left:-60%;width:35%;height:200%;background:rgba(255,255,255,0.18);transform:skewX(-20deg);transition:left 0.5s;}
#analyze-btn:hover::before{left:130%;}
#analyze-btn:hover{transform:translateY(-2px);box-shadow:0 12px 45px rgba(255,68,102,0.45);}
#analyze-btn:disabled{opacity:0.6;cursor:not-allowed;transform:none;}

/* SAMPLES */
.samples-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:0.6rem;}
.sample-item{border-radius:11px;cursor:pointer;border:2px solid rgba(255,255,255,0.05);transition:all 0.32s cubic-bezier(0.34,1.56,0.64,1);background:rgba(255,255,255,0.03);padding:0.7rem 0.4rem;text-align:center;position:relative;}
.sample-item:hover{border-color:var(--neon3);transform:translateY(-3px) scale(1.04);box-shadow:0 10px 25px rgba(255,190,0,0.18);}
.sample-item.selected{border-color:var(--orange);background:rgba(255,140,66,0.08);}
.sample-emoji{font-size:1.8rem;display:block;margin-bottom:0.3rem;}
.sample-name{font-size:0.65rem;color:var(--dim);line-height:1.3;}
.sample-tag{position:absolute;top:4px;right:4px;background:rgba(255,68,102,0.85);border-radius:3px;padding:1px 4px;font-size:0.5rem;font-family:'JetBrains Mono',monospace;color:white;}

/* NOTES */
.notes-area{width:100%;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:12px;padding:0.8rem;color:var(--text);font-family:'Outfit',sans-serif;font-size:0.85rem;resize:none;outline:none;transition:border-color 0.3s;line-height:1.6;}
.notes-area::placeholder{color:var(--dim);}
.notes-area:focus{border-color:rgba(0,255,204,0.3);}
.quick-tag{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);color:var(--dim);padding:0.28rem 0.65rem;border-radius:7px;cursor:pointer;font-size:0.73rem;transition:all 0.3s;font-family:'Outfit',sans-serif;}
.quick-tag:hover{border-color:rgba(0,255,204,0.3);color:var(--neon);}

/* DAMAGE */
.damage-list{display:flex;flex-direction:column;gap:0.6rem;}
.damage-item{display:flex;align-items:center;gap:0.7rem;padding:0.65rem 0.9rem;border-radius:11px;border:1px solid transparent;background:rgba(255,255,255,0.02);transition:all 0.5s;opacity:0.28;}
.damage-item.active{opacity:1;border-color:rgba(255,255,255,0.07);}
.d-icon{font-size:1.2rem;flex-shrink:0;}
.d-info{flex:1;min-width:0;}
.d-name{font-size:0.85rem;font-weight:600;}
.d-desc{font-size:0.67rem;color:var(--dim);margin-top:0.1rem;}
.d-bar{height:3px;border-radius:2px;margin-top:0.35rem;width:0%;transition:width 1.2s cubic-bezier(0.4,0,0.2,1);}
.d-count{font-family:'JetBrains Mono',monospace;font-size:0.95rem;font-weight:700;padding:0.15rem 0.6rem;border-radius:7px;background:rgba(255,255,255,0.05);}

/* METRICS */
.metrics-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:0.7rem;}
.metric-box{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.05);border-radius:12px;padding:0.9rem;text-align:center;transition:all 0.3s;}
.metric-box:hover{border-color:rgba(0,255,204,0.18);}
.m-val{font-family:'Orbitron',monospace;font-size:1.25rem;font-weight:700;color:var(--neon);}
.m-lbl{font-size:0.67rem;color:var(--dim);margin-top:0.25rem;text-transform:uppercase;letter-spacing:0.04em;}

/* REPAIR BREAKDOWN */
.repair-breakdown{display:flex;flex-direction:column;gap:0.5rem;}
.rb-row{display:flex;justify-content:space-between;align-items:center;padding:0.55rem 0.8rem;border-radius:10px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);}
.rb-label{font-size:0.8rem;color:var(--dim);}
.rb-cost{font-family:'JetBrains Mono',monospace;font-size:0.82rem;font-weight:700;color:var(--orange);}
.rb-total{background:rgba(255,140,66,0.09);border-color:rgba(255,140,66,0.22);}
.rb-total .rb-label{color:var(--text);font-weight:600;font-size:0.85rem;}
.rb-total .rb-cost{font-size:0.95rem;}

/* LOCATION */
.location-card{background:var(--card);border:1px solid rgba(0,255,204,0.12);border-radius:20px;padding:1.4rem;}
.loc-grid{background:rgba(0,255,204,0.03);border:1px solid rgba(0,255,204,0.08);border-radius:12px;padding:0.9rem;font-family:'JetBrains Mono',monospace;font-size:0.77rem;line-height:2.1;}
.loc-row{display:flex;justify-content:space-between;align-items:center;}
.loc-label{color:var(--dim);font-size:0.68rem;}
.loc-value{color:var(--neon);font-weight:600;font-size:0.75rem;}
.loc-btn{width:100%;margin-top:0.9rem;background:rgba(0,255,204,0.07);border:1px solid rgba(0,255,204,0.22);color:var(--neon);padding:0.65rem;border-radius:10px;font-family:'Outfit',sans-serif;font-size:0.88rem;font-weight:600;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:0.5rem;}
.loc-btn:hover{background:rgba(0,255,204,0.14);}
#mini-map{width:100%;height:155px;border-radius:12px;overflow:hidden;background:#0d1020;margin-top:0.8rem;border:1px solid rgba(0,255,204,0.1);display:none;}
#map-iframe{width:100%;height:100%;border:none;}

/* TERMINAL */
.terminal{background:#060810;border:1px solid rgba(0,255,204,0.1);border-radius:16px;overflow:hidden;}
.term-header{padding:0.6rem 0.9rem;background:rgba(0,255,204,0.04);border-bottom:1px solid rgba(0,255,204,0.08);display:flex;align-items:center;gap:0.4rem;}
.tdot{width:9px;height:9px;border-radius:50%;}
.term-title{font-family:'JetBrains Mono',monospace;font-size:0.7rem;color:var(--dim);margin-left:0.4rem;}
.term-body{padding:0.7rem;max-height:130px;overflow-y:auto;font-family:'JetBrains Mono',monospace;font-size:0.72rem;}
.term-body::-webkit-scrollbar{width:2px;}
.term-body::-webkit-scrollbar-thumb{background:rgba(0,255,204,0.2);border-radius:2px;}
.t-line{padding:0.18rem 0;animation:tIn 0.22s ease-out both;display:flex;gap:0.5rem;}
@keyframes tIn{from{opacity:0;transform:translateX(-6px)}to{opacity:1;transform:translateX(0)}}
.t-time{color:rgba(0,255,204,0.35);flex-shrink:0;}
.t-msg.success{color:#00e5a0;}.t-msg.warn{color:#ffdf00;}.t-msg.error{color:#ff4466;}.t-msg.info{color:#7a8aaa;}.t-msg.data{color:#a78bff;}

/* TIPS */
.tips-card{background:linear-gradient(135deg,rgba(255,107,255,0.06),rgba(167,139,255,0.04));border:1px solid rgba(255,107,255,0.15);border-radius:20px;padding:1.4rem;}
.tip-item{padding:0.75rem;border-radius:11px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.04);margin-bottom:0.6rem;font-size:0.8rem;line-height:1.6;display:flex;gap:0.6rem;transition:all 0.3s;}
.tip-item:hover{background:rgba(255,107,255,0.05);border-color:rgba(255,107,255,0.18);}
.tip-item:last-child{margin-bottom:0;}
.tip-icon{font-size:1rem;flex-shrink:0;}
.tip-text{color:var(--dim);}
.tip-text b{color:var(--text);}

/* REPORT */
.report-card{background:linear-gradient(135deg,rgba(0,255,204,0.07),rgba(0,184,255,0.04));border:1px solid rgba(0,255,204,0.17);border-radius:20px;padding:1.4rem;display:none;}
.report-title{font-size:0.95rem;font-weight:700;margin-bottom:0.4rem;display:flex;align-items:center;gap:0.5rem;}
.report-id{font-family:'JetBrains Mono',monospace;font-size:0.75rem;color:var(--dim);margin-bottom:0.6rem;}
.report-summary{font-size:0.8rem;color:var(--dim);margin-bottom:1rem;line-height:1.6;}
.report-actions{display:grid;grid-template-columns:1fr 1fr;gap:0.6rem;}
.r-btn{padding:0.7rem;border-radius:11px;font-family:'Outfit',sans-serif;font-size:0.85rem;font-weight:600;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:0.45rem;border:none;}
.r-btn.primary{background:linear-gradient(135deg,var(--neon),var(--blue));color:#07080f;grid-column:span 2;padding:0.9rem;box-shadow:0 6px 22px rgba(0,255,204,0.22);}
.r-btn.primary:hover{transform:translateY(-2px);box-shadow:0 10px 32px rgba(0,255,204,0.4);}
.r-btn.sec{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);color:var(--text);}
.r-btn.sec:hover{background:rgba(255,255,255,0.07);}

/* STATS */
.stats-panel{background:var(--card);border:1px solid rgba(255,255,255,0.06);border-radius:20px;padding:1.4rem;}
.xp-progress{background:rgba(255,255,255,0.06);border-radius:6px;height:8px;overflow:hidden;margin:0.8rem 0 0.5rem;}
.xp-bar-fill{height:100%;background:linear-gradient(90deg,var(--neon3),var(--orange));width:0%;border-radius:6px;transition:width 0.8s ease;}
.badge-row{display:flex;gap:0.4rem;flex-wrap:wrap;}
.badge-chip{font-size:0.68rem;padding:0.2rem 0.55rem;border-radius:6px;transition:all 0.5s;}
.badge-chip.earned{background:rgba(255,190,0,0.12);border:1px solid rgba(255,190,0,0.28);color:var(--neon3);}
.badge-chip.locked{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);color:var(--dim);opacity:0.4;}

/* HISTORY */
.history-section{position:relative;z-index:1;max-width:1600px;margin:0 auto;padding:0 1.5rem 5rem;}
.section-title{font-family:'Orbitron',monospace;font-size:0.8rem;color:var(--neon);letter-spacing:0.08em;margin-bottom:1.2rem;display:flex;align-items:center;gap:0.8rem;}
.section-title span{color:var(--dim);font-family:'JetBrains Mono',monospace;font-size:0.67rem;font-weight:400;}
.history-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(255px,1fr));gap:1rem;}
.history-item{background:var(--card);border:1px solid rgba(255,255,255,0.06);border-radius:15px;padding:1.1rem;transition:all 0.3s;cursor:pointer;}
.history-item:hover{border-color:rgba(0,255,204,0.18);transform:translateY(-2px);}
.h-top{display:flex;align-items:center;gap:0.7rem;margin-bottom:0.7rem;}
.h-icon{font-size:1.6rem;}
.h-name{font-weight:600;font-size:0.88rem;}
.h-date{font-size:0.7rem;color:var(--dim);}
.h-bar{height:5px;border-radius:3px;margin-bottom:0.7rem;}
.h-meta{display:flex;justify-content:space-between;font-size:0.72rem;color:var(--dim);}
.h-score{font-family:'JetBrains Mono',monospace;font-weight:700;padding:0.15rem 0.55rem;border-radius:5px;}

/* GAMIFICATION OVERLAYS */
.xp-toast{position:fixed;top:72px;right:18px;z-index:999;background:rgba(7,8,15,0.97);border:1px solid var(--neon3);border-radius:14px;padding:0.9rem 1.3rem;display:flex;align-items:center;gap:0.9rem;transform:translateX(150%);transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1);box-shadow:0 8px 35px rgba(255,190,0,0.18);min-width:210px;}
.xp-toast.show{transform:translateX(0);}
.xp-icon{font-size:1.8rem;}
.xp-text b{display:block;color:var(--neon3);font-family:'Orbitron',monospace;font-size:0.95rem;}
.xp-text span{font-size:0.77rem;color:var(--dim);}
.success-overlay{position:fixed;inset:0;z-index:9999;pointer-events:none;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.4s;background:rgba(0,0,0,0.65);backdrop-filter:blur(6px);}
.success-overlay.show{opacity:1;pointer-events:all;}
.success-card{background:rgba(7,8,15,0.98);border:2px solid var(--neon);border-radius:26px;padding:2.8rem;text-align:center;box-shadow:0 0 80px rgba(0,255,204,0.18);transform:scale(0.85);transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1);max-width:400px;width:90%;position:relative;}
.success-overlay.show .success-card{transform:scale(1);}
.success-icon{font-size:4.5rem;margin-bottom:0.8rem;display:block;}
.success-card h2{font-family:'Orbitron',monospace;font-size:1.4rem;color:var(--neon);margin-bottom:0.5rem;}
.success-card p{color:var(--dim);margin-bottom:1.4rem;font-size:0.88rem;line-height:1.7;}
.confetti-wrap{position:absolute;inset:0;pointer-events:none;overflow:hidden;border-radius:26px;}
.confetti-piece{position:absolute;border-radius:2px;animation:cfFall var(--dur,2s) ease-in var(--delay,0s) forwards;}
@keyframes cfFall{0%{transform:translateY(-80px) rotate(0deg) translateX(var(--sx,0px));opacity:1;}100%{transform:translateY(400px) rotate(720deg) translateX(calc(var(--sx,0px) + var(--ex,30px)));opacity:0;}}

/* WEATHER MODAL */
.modal-overlay{position:fixed;inset:0;z-index:500;background:rgba(0,0,0,0.72);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.3s;}
.modal-overlay.show{opacity:1;pointer-events:all;}
.modal-card{background:#0d1020;border:1px solid rgba(0,184,255,0.22);border-radius:22px;padding:2rem;max-width:440px;width:90%;transform:scale(0.9);transition:transform 0.4s cubic-bezier(0.34,1.56,0.64,1);position:relative;}
.modal-overlay.show .modal-card{transform:scale(1);}
.modal-close{position:absolute;top:0.9rem;right:0.9rem;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:var(--dim);width:28px;height:28px;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:0.75rem;transition:all 0.3s;}
.modal-close:hover{border-color:var(--red);color:var(--red);}

@media(max-width:1200px){.page-body{grid-template-columns:275px 1fr 320px;}}
@media(max-width:960px){.page-body{grid-template-columns:1fr;}.col-left{order:3;}.col-right{order:2;}}
@media(max-width:600px){nav{padding:0.7rem 1rem;}.page-body{padding:0 0.8rem 5rem;}}
::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-track{background:transparent;}::-webkit-scrollbar-thumb{background:rgba(0,255,204,0.18);border-radius:2px;}
input[type=file]{display:none;}
</style>
</head>
<body>
<div class="bg-grid"></div>
<div class="bg-blob blob1"></div><div class="bg-blob blob2"></div><div class="bg-blob blob3"></div>

<!-- XP Toast -->
<div class="xp-toast" id="xp-toast">
  <span class="xp-icon">‚≠ê</span>
  <div class="xp-text"><b id="xp-amount">+150 XP</b><span id="xp-reason">Report submitted!</span></div>
</div>

<!-- Success -->
<div class="success-overlay" id="success-overlay" onclick="closeSuccess()">
  <div class="success-card" onclick="event.stopPropagation()">
    <div class="confetti-wrap" id="confetti-wrap"></div>
    <span class="success-icon">üéâ</span>
    <h2>REPORT SUBMITTED!</h2>
    <p>Sent to Municipal Corporation üèõÔ∏è<br>You earned <b style="color:var(--neon3)">+150 XP</b> and unlocked <b style="color:var(--neon2)">üèÖ Crack Hunter</b> badge!</p>
    <div id="success-ref" style="font-family:'JetBrains Mono',monospace;font-size:0.8rem;color:var(--neon);margin-bottom:1.4rem;"></div>
    <button onclick="closeSuccess()" style="background:linear-gradient(135deg,var(--neon),var(--blue));color:#07080f;border:none;padding:0.75rem 2.2rem;border-radius:11px;font-family:'Orbitron',monospace;font-size:0.85rem;font-weight:700;cursor:pointer;letter-spacing:0.04em;">AWESOME! üöÄ</button>
  </div>
</div>

<!-- Weather Modal -->
<div class="modal-overlay" id="weather-modal" onclick="closeWeatherModal()">
  <div class="modal-card" onclick="event.stopPropagation()">
    <button class="modal-close" onclick="closeWeatherModal()">‚úï</button>
    <div style="font-family:'Orbitron',monospace;font-size:0.95rem;font-weight:900;color:var(--blue);margin-bottom:1.4rem;">üå§Ô∏è WEATHER DETAILS</div>
    <div id="modal-weather-content"></div>
  </div>
</div>

<!-- NAV -->
<nav>
  <a href="index.html" class="back-btn">‚Üê Back</a>
  <span class="nav-logo">üõ£Ô∏è CRACK HUNTER</span>
  <div class="nav-right">
    <div class="nbadge live"><div class="live-dot"></div>LIVE AI</div>
    <div class="nbadge wth" onclick="openWeatherModal()">‚òÅÔ∏è <span id="nav-weather">--¬∞C</span></div>
    <div class="nbadge xp">‚≠ê <span id="total-xp">0</span> XP</div>
  </div>
</nav>

<!-- HERO -->
<div class="hero">
  <div class="hero-badge">üïµÔ∏è AI-POWERED ROAD INTELLIGENCE v3.2</div>
  <h1><span class="g1">HUNT</span> THE <span class="g2">CRACKS</span></h1>
  <p class="hero-sub">Upload road photos ¬∑ AI detects every crack ¬∑ Tag location ¬∑ File reports ¬∑ Earn XP ¬∑ Fix your city</p>
  <div class="steps-row">
    <div class="step-chip active" id="chip-1"><div class="step-num">1</div>Upload</div>
    <span class="step-arrow">‚Ä∫</span>
    <div class="step-chip" id="chip-2"><div class="step-num">2</div>Detect</div>
    <span class="step-arrow">‚Ä∫</span>
    <div class="step-chip" id="chip-3"><div class="step-num">3</div>Location</div>
    <span class="step-arrow">‚Ä∫</span>
    <div class="step-chip" id="chip-4"><div class="step-num">4</div>Report</div>
  </div>
</div>

<!-- 3-COLUMN BODY -->
<div class="page-body">

  <!-- ===== LEFT ===== -->
  <div class="col-left">

    <!-- Severity Score Ring -->
    <div class="score-card">
      <div class="panel-title" style="justify-content:center;margin-bottom:0.8rem;"><span>‚ö°</span> DAMAGE SEVERITY</div>
      <div class="score-ring-wrap">
        <svg width="130" height="130" viewBox="0 0 130 130">
          <circle cx="65" cy="65" r="55" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="9"/>
          <circle id="score-circle" cx="65" cy="65" r="55" fill="none" stroke="url(#sg)" stroke-width="9" stroke-linecap="round"/>
          <defs><linearGradient id="sg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ff8c42"/><stop offset="100%" stop-color="#ff3355"/></linearGradient></defs>
        </svg>
        <div class="score-inner"><div id="score-num">--</div><div class="score-max">/100</div></div>
      </div>
      <div class="score-verdict" id="score-verdict">Awaiting Scan</div>
      <div class="urgency-pill" id="urgency-pill">‚Äî Upload a road image ‚Äî</div>
    </div>

    <!-- Weather Widget -->
    <div class="weather-card">
      <div class="panel-title"><span>üå§Ô∏è</span> WEATHER AT LOCATION</div>
      <div class="weather-main">
        <span class="weather-icon" id="w-icon">‚è≥</span>
        <div>
          <div class="weather-temp" id="w-temp">--¬∞C</div>
          <div class="weather-city" id="w-city">Loading...</div>
          <div class="weather-desc" id="w-desc">Fetching weather data</div>
        </div>
      </div>
      <div class="weather-grid">
        <div class="w-item"><div class="w-val" id="w-humidity">--%</div><div class="w-lbl">Humidity</div></div>
        <div class="w-item"><div class="w-val" id="w-wind">--</div><div class="w-lbl">Wind km/h</div></div>
        <div class="w-item"><div class="w-val" id="w-vis">--</div><div class="w-lbl">Visibility</div></div>
      </div>
      <div class="weather-impact" id="w-impact"><span>‚è≥</span><span>Loading weather impact...</span></div>
    </div>

    <!-- Damage Classification -->
    <div class="panel">
      <div class="panel-title"><span>üî¨</span> DAMAGE CLASSIFICATION</div>
      <div class="damage-list">
        <div class="damage-item" id="dt-alligator"><span class="d-icon">üêä</span><div class="d-info"><div class="d-name" style="color:#ff4466">Alligator Cracking</div><div class="d-desc">Interconnected fatigue cracks</div><div class="d-bar" style="background:#ff4466"></div></div><div class="d-count" style="color:#ff4466" id="cnt-alligator">0</div></div>
        <div class="damage-item" id="dt-pothole"><span class="d-icon">üï≥Ô∏è</span><div class="d-info"><div class="d-name" style="color:#ff8c42">Potholes</div><div class="d-desc">Structural road collapse</div><div class="d-bar" style="background:#ff8c42"></div></div><div class="d-count" style="color:#ff8c42" id="cnt-pothole">0</div></div>
        <div class="damage-item" id="dt-longit"><span class="d-icon">üìè</span><div class="d-info"><div class="d-name" style="color:#ffdf00">Longitudinal</div><div class="d-desc">Parallel-to-road cracks</div><div class="d-bar" style="background:#ffdf00"></div></div><div class="d-count" style="color:#ffdf00" id="cnt-longit">0</div></div>
        <div class="damage-item" id="dt-transverse"><span class="d-icon">‚ÜîÔ∏è</span><div class="d-info"><div class="d-name" style="color:#a78bff">Transverse</div><div class="d-desc">Perpendicular cracks</div><div class="d-bar" style="background:#a78bff"></div></div><div class="d-count" style="color:#a78bff" id="cnt-transverse">0</div></div>
        <div class="damage-item" id="dt-edge"><span class="d-icon">‚óªÔ∏è</span><div class="d-info"><div class="d-name" style="color:var(--neon)">Edge Damage</div><div class="d-desc">Shoulder deterioration</div><div class="d-bar" style="background:var(--neon)"></div></div><div class="d-count" style="color:var(--neon)" id="cnt-edge">0</div></div>
      </div>
    </div>

    <!-- AI Tips -->
    <div class="tips-card">
      <div class="panel-title"><span>ü§ñ</span> AI REPAIR INSIGHTS</div>
      <div id="tips-list">
        <div class="tip-item"><span class="tip-icon">üí°</span><span class="tip-text">Upload a road photo to get <b>AI-powered repair recommendations</b>.</span></div>
        <div class="tip-item"><span class="tip-icon">üìç</span><span class="tip-text">Enable location for <b>weather-adjusted repair timelines</b> in your area.</span></div>
        <div class="tip-item"><span class="tip-icon">üèÜ</span><span class="tip-text">Reach <b>500 XP</b> to unlock the Gold Eco-Warrior badge!</span></div>
      </div>
    </div>

  </div>

  <!-- ===== CENTER ===== -->
  <div class="col-center">

    <!-- Drop Zone -->
    <div class="drop-zone" id="drop-zone">
      <span class="drop-icon">üì∏</span>
      <h3>Drop Your Road Photo Here</h3>
      <p>JPG, PNG, WEBP ¬∑ Any road image ¬∑ Instant AI detection</p>
      <div class="upload-btns">
        <button class="btn-up" onclick="document.getElementById('file-in').click()">üìÅ Browse Files</button>
        <button class="btn-cam" onclick="startCamera()">üì∑ Camera</button>
      </div>
    </div>
    <input type="file" id="file-in" accept="image/*" onchange="handleFile(this.files[0])">

    <!-- Preview -->
    <div id="preview-wrap">
      <img id="preview-img" alt="">
      <div class="preview-toolbar">
        <div class="tool-btn" onclick="document.getElementById('file-in').click()" title="Change image">üîÑ</div>
        <div class="tool-btn" onclick="toggleZoom()" title="Zoom toggle">üîç</div>
        <div class="tool-btn" onclick="downloadAnnotated()" title="Save annotated">üíæ</div>
      </div>
      <div id="scan-overlay">
        <div class="grid-ovl"></div>
        <div class="scan-line-el"></div>
        <div class="hud-c tl"></div><div class="hud-c tr"></div>
        <div class="hud-c bl"></div><div class="hud-c br"></div>
        <div class="scan-status" id="scan-status-txt">INITIALIZING...</div>
      </div>
    </div>

    <!-- Analyze -->
    <button id="analyze-btn" onclick="startAnalysis()">üî¨ &nbsp; ACTIVATE CRACK DETECTOR</button>

    <!-- Field Notes (hidden until image loaded) -->
    <div class="panel" id="notes-panel" style="display:none;">
      <div class="panel-title"><span>üìù</span> FIELD NOTES</div>
      <textarea class="notes-area" id="field-notes" rows="3" placeholder="Add observations: location details, traffic, time of day, waterlogging..."></textarea>
      <div style="margin-top:0.6rem;display:flex;gap:0.5rem;flex-wrap:wrap;">
        <button class="quick-tag" onclick="addNote('Heavy vehicle traffic')">üöõ Heavy traffic</button>
        <button class="quick-tag" onclick="addNote('Near school zone')">üè´ Near school</button>
        <button class="quick-tag" onclick="addNote('Waterlogging observed')">üíß Waterlogging</button>
        <button class="quick-tag" onclick="addNote('Night visibility hazard')">üåô Night hazard</button>
        <button class="quick-tag" onclick="addNote('Accident-prone area')">‚ö†Ô∏è Accident prone</button>
      </div>
    </div>

    <!-- Samples -->
    <div class="panel">
      <div class="panel-title"><span>üß™</span> TRY SAMPLE ROAD IMAGES</div>
      <div class="samples-grid">
        <div class="sample-item" onclick="loadSample('heavy')" id="s-heavy"><div class="sample-tag">CRITICAL</div><span class="sample-emoji">üíÄ</span><span class="sample-name">Heavy Alligator</span></div>
        <div class="sample-item" onclick="loadSample('pothole')" id="s-pothole"><div class="sample-tag">HIGH</div><span class="sample-emoji">üï≥Ô∏è</span><span class="sample-name">Potholes</span></div>
        <div class="sample-item" onclick="loadSample('longit')" id="s-longit"><span class="sample-emoji">üìè</span><span class="sample-name">Longitudinal</span></div>
        <div class="sample-item" onclick="loadSample('transverse')" id="s-transverse"><span class="sample-emoji">‚ÜîÔ∏è</span><span class="sample-name">Transverse</span></div>
        <div class="sample-item" onclick="loadSample('edge')" id="s-edge"><span class="sample-emoji">‚óªÔ∏è</span><span class="sample-name">Edge Damage</span></div>
        <div class="sample-item" onclick="loadSample('good')" id="s-good"><span class="sample-emoji">‚úÖ</span><span class="sample-name">Good Road</span></div>
      </div>
    </div>

    <!-- Terminal -->
    <div class="terminal">
      <div class="term-header">
        <div class="tdot" style="background:#ff5f57"></div>
        <div class="tdot" style="background:#ffbd2e"></div>
        <div class="tdot" style="background:#28c840"></div>
        <span class="term-title">// SustainX Neural Engine ‚Äî Live Log</span>
      </div>
      <div class="term-body" id="term-body">
        <div class="t-line"><span class="t-time">00.00</span><span class="t-msg info">CrackHunter v3.2 initialized</span></div>
        <div class="t-line"><span class="t-time">00.00</span><span class="t-msg info">YOLOv8-RoadDamage model loaded ‚úì</span></div>
        <div class="t-line"><span class="t-time">00.00</span><span class="t-msg success">‚ñ∂ Ready ‚Äî awaiting input</span></div>
      </div>
    </div>

  </div>

  <!-- ===== RIGHT ===== -->
  <div class="col-right">

    <!-- Location -->
    <div class="location-card">
      <div class="panel-title"><span>üìç</span> LOCATION DATA</div>
      <div class="loc-grid">
        <div class="loc-row"><span class="loc-label">STATUS</span><span class="loc-value" id="loc-status">Not captured</span></div>
        <div class="loc-row"><span class="loc-label">LATITUDE</span><span class="loc-value" id="loc-lat">--</span></div>
        <div class="loc-row"><span class="loc-label">LONGITUDE</span><span class="loc-value" id="loc-lng">--</span></div>
        <div class="loc-row"><span class="loc-label">AREA</span><span class="loc-value" id="loc-area" style="font-size:0.7rem;max-width:185px;text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">--</span></div>
        <div class="loc-row"><span class="loc-label">ACCURACY</span><span class="loc-value" id="loc-acc">--</span></div>
        <div class="loc-row"><span class="loc-label">TIME</span><span class="loc-value" id="loc-time">--</span></div>
      </div>
      <button class="loc-btn" id="loc-btn" onclick="getLocation()">üì° Detect My Location</button>
      <div id="mini-map"><iframe id="map-iframe" allowfullscreen></iframe></div>
    </div>

    <!-- Metrics -->
    <div class="panel">
      <div class="panel-title"><span>üìä</span> ANALYSIS METRICS</div>
      <div class="metrics-grid">
        <div class="metric-box"><div class="m-val" id="m-coverage">--%</div><div class="m-lbl">Damage Area</div></div>
        <div class="metric-box"><div class="m-val" id="m-defects">--</div><div class="m-lbl">Defects</div></div>
        <div class="metric-box"><div class="m-val" id="m-pci" style="color:var(--neon3)">--</div><div class="m-lbl">PCI Rating</div></div>
        <div class="metric-box"><div class="m-val" id="m-conf" style="color:var(--neon2)">--%</div><div class="m-lbl">Confidence</div></div>
        <div class="metric-box"><div class="m-val" id="m-scantime" style="color:var(--blue)">--</div><div class="m-lbl">Scan Time</div></div>
        <div class="metric-box"><div class="m-val" id="m-road-age" style="color:var(--dim)">--</div><div class="m-lbl">Est. Road Age</div></div>
      </div>
    </div>

    <!-- Repair Cost Breakdown -->
    <div class="panel" id="repair-panel" style="display:none;">
      <div class="panel-title"><span>üí∞</span> REPAIR COST BREAKDOWN</div>
      <div class="repair-breakdown" id="repair-breakdown"></div>
    </div>

    <!-- Report Card -->
    <div class="report-card" id="report-card">
      <div class="report-title">üìã File Official Report</div>
      <div class="report-id" id="report-id">REF: SX-??????-????</div>
      <div class="report-summary" id="report-summary"></div>
      <div class="report-actions">
        <button class="r-btn primary" id="submit-btn" onclick="submitReport()">üö® Report to Municipality</button>
        <button class="r-btn sec" onclick="exportData()">üíæ Export CSV</button>
        <button class="r-btn sec" onclick="shareReport()">üîó Share</button>
      </div>
    </div>

    <!-- Citizen Stats -->
    <div class="stats-panel">
      <div class="panel-title"><span>üèÜ</span> YOUR STATS</div>
      <div class="metrics-grid">
        <div class="metric-box"><div class="m-val" id="stat-reports" style="color:var(--neon3)">0</div><div class="m-lbl">Reports</div></div>
        <div class="metric-box"><div class="m-val" id="stat-defects" style="color:var(--red)">0</div><div class="m-lbl">Defects Found</div></div>
        <div class="metric-box"><div class="m-val" id="stat-streak" style="color:var(--orange)">1üî•</div><div class="m-lbl">Day Streak</div></div>
        <div class="metric-box"><div class="m-val" id="stat-rank" style="color:var(--neon2)">#--</div><div class="m-lbl">City Rank</div></div>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:0.7rem;color:var(--dim);margin-top:1rem;margin-bottom:0.35rem;">
        <span>Level <span id="xp-level" style="color:var(--neon3)">1</span> Rookie</span>
        <span><span id="xp-cur">0</span>/500 XP</span>
      </div>
      <div class="xp-progress"><div class="xp-bar-fill" id="xp-bar"></div></div>
      <div class="badge-row">
        <span class="badge-chip earned" id="badge-rookie">üå± Rookie</span>
        <span class="badge-chip locked" id="badge-hunter">üèÖ Hunter</span>
        <span class="badge-chip locked" id="badge-warrior">‚öîÔ∏è Warrior</span>
        <span class="badge-chip locked" id="badge-legend">üèÜ Legend</span>
      </div>
    </div>

  </div>
</div>

<!-- HISTORY -->
<div class="history-section">
  <div class="section-title">üìÇ COMMUNITY DETECTIONS <span>‚Äî recent reports from Maharashtra</span></div>
  <div class="history-grid" id="history-grid"></div>
</div>

<script>
let locationData=null,analysisResult=null,totalXP=0,currentSample=null,myReports=0,myDefects=0,tStart=Date.now();

const S={
  heavy:{sev:88,lbl:'CRITICAL',urg:'üî¥ IMMEDIATE REPAIR',uc:'rgba(255,51,85,0.14)',ub:'rgba(255,51,85,0.38)',
    types:{alligator:8,pothole:3,longit:4,transverse:2,edge:1},bars:{alligator:90,pothole:60,longit:70,transverse:40,edge:20},
    cov:42,conf:97,pci:18,days:14,age:'8-10 yrs',
    repair:{survey:2000,material:45000,labour:22000,machinery:12000,misc:4000},
    tips:['Alligator cracking signals <b>structural failure</b> ‚Äî base layer compromised','<b>Full-depth reclamation</b> needed, not just surface patching','Delay = <b>3x more damage</b> in next monsoon season','Recommend <b>traffic diversion</b> until repairs complete']},
  pothole:{sev:74,lbl:'HIGH',urg:'üü† REPAIR WITHIN 30 DAYS',uc:'rgba(255,140,66,0.1)',ub:'rgba(255,140,66,0.3)',
    types:{alligator:2,pothole:6,longit:1,transverse:2,edge:1},bars:{alligator:30,pothole:95,longit:15,transverse:30,edge:10},
    cov:28,conf:98,pci:32,days:30,age:'5-7 yrs',
    repair:{survey:1500,material:22000,labour:12000,machinery:6000,misc:2500},
    tips:['<b>6 potholes detected</b> ‚Äî patch with hot-mix asphalt','Potholes expand <b>40% faster</b> in monsoon conditions','Each pothole causes avg <b>‚Çπ3,200 vehicle damage</b> per incident','Schedule repair <b>before next rain cycle</b>']},
  longit:{sev:52,lbl:'MODERATE',urg:'üü° SCHEDULE REPAIR',uc:'rgba(255,223,0,0.09)',ub:'rgba(255,223,0,0.28)',
    types:{alligator:0,pothole:0,longit:5,transverse:1,edge:2},bars:{alligator:0,pothole:0,longit:85,transverse:15,edge:25},
    cov:19,conf:93,pci:48,days:60,age:'3-5 yrs',
    repair:{survey:1000,material:10000,labour:6500,machinery:3000,misc:1500},
    tips:['Longitudinal cracks = <b>early structural warning signs</b>','Seal now to <b>prevent water infiltration</b> and base damage','Crack sealing now costs <b>8x less</b> than future reconstruction','Check <b>sub-base drainage</b> as root cause']},
  transverse:{sev:45,lbl:'MODERATE',urg:'üü° SCHEDULE REPAIR',uc:'rgba(255,223,0,0.09)',ub:'rgba(255,223,0,0.28)',
    types:{alligator:0,pothole:1,longit:0,transverse:5,edge:0},bars:{alligator:0,pothole:12,longit:0,transverse:80,edge:0},
    cov:15,conf:91,pci:55,days:90,age:'4-6 yrs',
    repair:{survey:800,material:7000,labour:4500,machinery:2500,misc:1200},
    tips:['Caused by <b>thermal expansion/contraction</b> cycles','Apply <b>polymer-modified sealant</b> for best durability','Spacing <0.5m = <b>advanced deterioration</b>','Low priority ‚Äî schedule within <b>3 months</b>']},
  edge:{sev:60,lbl:'HIGH',urg:'üü† REPAIR WITHIN 30 DAYS',uc:'rgba(255,140,66,0.1)',ub:'rgba(255,140,66,0.3)',
    types:{alligator:2,pothole:1,longit:1,transverse:0,edge:5},bars:{alligator:25,pothole:10,longit:15,transverse:0,edge:90},
    cov:24,conf:89,pci:41,days:45,age:'6-8 yrs',
    repair:{survey:1200,material:15000,labour:9000,machinery:5000,misc:2000},
    tips:['Edge damage = <b>poor drainage design</b>','Shoulder reinforcement needed alongside repair','Risk of <b>lane narrowing accidents</b> if untreated','Install <b>edge barriers</b> post-repair']},
  good:{sev:5,lbl:'GOOD',urg:'‚úÖ NO ACTION NEEDED',uc:'rgba(0,229,160,0.07)',ub:'rgba(0,229,160,0.22)',
    types:{alligator:0,pothole:0,longit:0,transverse:0,edge:0},bars:{alligator:0,pothole:0,longit:0,transverse:0,edge:0},
    cov:0,conf:95,pci:92,days:0,age:'0-2 yrs',
    repair:{survey:0,material:0,labour:0,machinery:0,misc:0},
    tips:['Road is in <b>excellent condition</b> ‚Äî no repair needed','Schedule <b>preventive sealing in 2 years</b>','Continue <b>monitoring every 6 months</b>','Great example of <b>good maintenance!</b>']},
};

// History
(()=>{
  const hist=[{n:'MH Highway 52',s:78,c:'#ff8c42',i:'üï≥Ô∏è',d:'2h ago',l:'Aurangabad, MH',def:9},{n:'Nanded Ring Road',s:91,c:'#ff3355',i:'üíÄ',d:'5h ago',l:'Nanded, MH',def:15},{n:'Osmanabad Bypass',s:44,c:'#ffdf00',i:'üìè',d:'1d ago',l:'Osmanabad, MH',def:4},{n:'Solapur Rd Sec-3',s:12,c:'#00e5a0',i:'‚úÖ',d:'2d ago',l:'Solapur, MH',def:1},{n:'Latur NH-361',s:67,c:'#ff8c42',i:'‚óªÔ∏è',d:'2d ago',l:'Latur, MH',def:7},{n:'Beed District Rd',s:83,c:'#ff3355',i:'üêä',d:'3d ago',l:'Beed, MH',def:12}];
  const g=document.getElementById('history-grid');
  hist.forEach(h=>{g.innerHTML+=`<div class="history-item"><div class="h-top"><span class="h-icon">${h.i}</span><div><div class="h-name">${h.n}</div><div class="h-date">üìç ${h.l} ¬∑ ${h.d}</div></div></div><div class="h-bar" style="background:linear-gradient(90deg,${h.c},${h.c}44);width:${h.s}%"></div><div class="h-meta"><span>${h.def} defects</span><span class="h-score" style="background:${h.c}1a;color:${h.c}">Score: ${h.s}</span></div></div>`;});
})();

// FILE HANDLING
const dz=document.getElementById('drop-zone');
dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('over');});
dz.addEventListener('dragleave',()=>dz.classList.remove('over'));
dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('over');if(e.dataTransfer.files[0])handleFile(e.dataTransfer.files[0]);});

function handleFile(file){
  if(!file||!file.type.startsWith('image/'))return;
  currentSample=null;
  document.querySelectorAll('.sample-item').forEach(s=>s.classList.remove('selected'));
  const r=new FileReader();
  r.onload=e=>showPreview(e.target.result);
  r.readAsDataURL(file);
  tlog('info',`Loaded: ${file.name} (${(file.size/1024).toFixed(0)}KB)`);
}

function loadSample(id){
  currentSample=id;
  document.querySelectorAll('.sample-item').forEach(s=>s.classList.remove('selected'));
  document.getElementById('s-'+id).classList.add('selected');
  const c=document.createElement('canvas');c.width=900;c.height=500;
  paintRoad(c.getContext('2d'),900,500,id);
  showPreview(c.toDataURL());
  tlog('data',`Sample: "${S[id].lbl}" scenario`);
}

function showPreview(src){
  dz.style.display='none';
  document.getElementById('preview-wrap').style.display='block';
  document.getElementById('preview-img').src=src;
  document.getElementById('analyze-btn').style.display='block';
  document.getElementById('notes-panel').style.display='block';
  clearBoxes();resetMetrics();
  document.getElementById('report-card').style.display='none';
  document.getElementById('repair-panel').style.display='none';
  setStep(1);
}

// ROAD PAINTER
function paintRoad(ctx,W,H,type){
  let g=ctx.createLinearGradient(0,0,0,H*0.3);g.addColorStop(0,'#060810');g.addColorStop(1,'#0f1520');ctx.fillStyle=g;ctx.fillRect(0,0,W,H*0.3);
  g=ctx.createLinearGradient(0,H*0.3,0,H);g.addColorStop(0,'#222428');g.addColorStop(1,'#151517');ctx.fillStyle=g;ctx.fillRect(0,H*0.3,W,H*0.7);
  for(let i=0;i<3500;i++){ctx.fillStyle=`rgba(${Math.random()>0.5?255:0},${Math.random()>0.5?255:0},${Math.random()>0.5?255:0},0.016)`;ctx.fillRect(Math.random()*W,H*0.3+Math.random()*H*0.7,1.5,1.5);}
  ctx.strokeStyle='rgba(255,210,0,0.55)';ctx.lineWidth=4;ctx.setLineDash([45,35]);ctx.beginPath();ctx.moveTo(W/2,H*0.3);ctx.lineTo(W/2,H);ctx.stroke();ctx.setLineDash([]);
  ctx.strokeStyle='rgba(255,255,255,0.38)';ctx.lineWidth=3;ctx.beginPath();ctx.moveTo(90,H*0.3);ctx.lineTo(90,H);ctx.moveTo(W-90,H*0.3);ctx.lineTo(W-90,H);ctx.stroke();
  if(type==='heavy')pAlligator(ctx,W,H,7);else if(type==='pothole')pPothole(ctx,W,H,5);else if(type==='longit')pLongit(ctx,W,H,4);else if(type==='transverse')pTransverse(ctx,W,H,5);else if(type==='edge')pEdge(ctx,W,H);
}
function pAlligator(ctx,W,H,n){for(let i=0;i<n;i++){const cx=180+Math.random()*(W-360),cy=H*0.42+Math.random()*(H*0.45),r=50+Math.random()*70;ctx.lineWidth=1.5;ctx.strokeStyle='rgba(42,44,48,0.9)';for(let j=0;j<10;j++){const a=(j/10)*Math.PI*2;ctx.beginPath();ctx.moveTo(cx,cy);ctx.quadraticCurveTo(cx+Math.cos(a+0.4)*r*0.45,cy+Math.sin(a+0.4)*r*0.45,cx+Math.cos(a)*r*(0.6+Math.random()*0.8),cy+Math.sin(a)*r*(0.6+Math.random()*0.8));ctx.stroke();for(let k=1;k<=2;k++){ctx.beginPath();const mx=cx+Math.cos(a)*r*0.45*k,my=cy+Math.sin(a)*r*0.45*k;ctx.moveTo(mx,my);const sa=a+(Math.random()-0.5)*1.8;ctx.lineTo(mx+Math.cos(sa)*(15+Math.random()*22),my+Math.sin(sa)*(15+Math.random()*22));ctx.stroke();}}}}
function pPothole(ctx,W,H,n){for(let i=0;i<n;i++){const cx=180+Math.random()*(W-360),cy=H*0.43+Math.random()*(H*0.44),rx=35+Math.random()*50,ry=25+Math.random()*38;const g2=ctx.createRadialGradient(cx,cy,0,cx,cy,rx);g2.addColorStop(0,'#060608');g2.addColorStop(0.7,'#111114');g2.addColorStop(1,'#1e1e20');ctx.fillStyle=g2;ctx.beginPath();ctx.ellipse(cx,cy,rx,ry,Math.random()*Math.PI,0,Math.PI*2);ctx.fill();ctx.strokeStyle='#2a2a2e';ctx.lineWidth=2;ctx.stroke();}}
function pLongit(ctx,W,H,n){for(let i=0;i<n;i++){ctx.strokeStyle='rgba(38,40,44,0.9)';ctx.lineWidth=1.5+Math.random();ctx.beginPath();let cx=150+(i/(n-1||1))*(W-300)+Math.random()*60;ctx.moveTo(cx,H*0.31);for(let y=H*0.31;y<H;y+=25){cx+=(Math.random()-0.5)*10;ctx.lineTo(cx,y);}ctx.stroke();}}
function pTransverse(ctx,W,H,n){for(let i=0;i<n;i++){ctx.strokeStyle='rgba(36,38,42,0.95)';ctx.lineWidth=2;ctx.beginPath();let cy=H*0.38+i*(H*0.12)+Math.random()*H*0.03;ctx.moveTo(90,cy);for(let x=90;x<W-90;x+=20){cy+=(Math.random()-0.5)*7;ctx.lineTo(x,cy);}ctx.stroke();}}
function pEdge(ctx,W,H){ctx.fillStyle='#0e0e10';for(let i=0;i<10;i++){ctx.beginPath();const y=H*0.35+i*(H*0.065);ctx.moveTo(0,y);ctx.lineTo(70+Math.random()*55,y+8);ctx.lineTo(60+Math.random()*45,y+28);ctx.lineTo(0,y+22);ctx.fill();}ctx.strokeStyle='rgba(38,40,44,0.9)';ctx.lineWidth=1.5;for(let i=0;i<6;i++){ctx.beginPath();const sy=H*0.38+i*(H*0.1);ctx.moveTo(95,sy);ctx.lineTo(95+60+Math.random()*90,sy+(Math.random()-0.5)*28);ctx.stroke();}}

// ANALYSIS
const SCAN_MSGS=['INIT NEURAL ENGINE...','PREPROCESSING...','EDGE DETECTION P1...','EDGE DETECTION P2...','CRACK SEGMENTATION...','PATTERN RECOGNITION...','DEPTH ESTIMATION...','SEVERITY ANALYSIS...','PCI COMPUTATION...','GENERATING REPORT...'];

async function startAnalysis(){
  const btn=document.getElementById('analyze-btn');
  btn.disabled=true;btn.innerHTML='‚è≥ &nbsp; ANALYZING...';
  setStep(2);document.getElementById('scan-overlay').style.display='block';
  const ms0=Date.now();let mi=0;
  const si=setInterval(()=>{document.getElementById('scan-status-txt').textContent=SCAN_MSGS[mi%SCAN_MSGS.length];mi++;},380);
  const logs=[['info','Preprocessing: noise reduction, contrast normalization'],['info','Canny edge detection ‚Äî threshold: 120/255'],['data','YOLOv8 inference pass 1/2'],['warn','Checking alligator fatigue patterns...'],['data','Pothole depth estimation: stereo match'],['data','Longitudinal/transverse crack classifier'],['warn','Edge damage boundary detection'],['data','PCI ‚Äî ASTM D6433 methodology'],['success','Segmentation mask complete'],['success','Report compilation ‚Äî done']];
  for(let i=0;i<logs.length;i++){await sleep(310);tlog(logs[i][0],logs[i][1]);}
  clearInterval(si);document.getElementById('scan-overlay').style.display='none';
  const scanSec=((Date.now()-ms0)/1000).toFixed(2);
  const data=currentSample?S[currentSample]:randScenario();
  analysisResult=data;

  animateScore(data.sev,data.lbl);
  const up=document.getElementById('urgency-pill');
  up.textContent=data.urg;up.style.background=data.uc;up.style.borderColor=data.ub;up.style.color=getScoreColor(data.sev);

  if(data.sev>=10) drawDetections(data);

  await sleep(300);
  document.getElementById('m-coverage').textContent=data.cov+'%';
  const tot=Object.values(data.types).reduce((a,b)=>a+b,0);
  document.getElementById('m-defects').textContent=tot||'None';
  document.getElementById('m-pci').textContent=data.pci;
  document.getElementById('m-conf').textContent=data.conf+'%';
  document.getElementById('m-scantime').textContent=scanSec+'s';
  document.getElementById('m-road-age').textContent=data.age;

  await sleep(200);
  ['alligator','pothole','longit','transverse','edge'].forEach((k,i)=>{
    setTimeout(()=>{
      if(data.types[k]>0){
        document.getElementById('dt-'+k).classList.add('active');
        document.getElementById('cnt-'+k).textContent=data.types[k];
        document.querySelector('#dt-'+k+' .d-bar').style.width=data.bars[k]+'%';
      }
    },i*140);
  });

  await sleep(500);
  showRepairBreakdown(data.repair,data.sev);
  showTips(data.tips);

  const ref='SX-'+Date.now().toString().slice(-6)+'-'+Math.random().toString(36).slice(2,6).toUpperCase();
  document.getElementById('report-id').textContent='REF: '+ref;
  const total=Object.values(data.repair).reduce((a,b)=>a+b,0);
  document.getElementById('report-summary').textContent=data.sev<10?'Road is in good condition ‚Äî no repair needed.':`${tot} defects ¬∑ ${data.cov}% damage area ¬∑ PCI ${data.pci}/100 ¬∑ Est. ‚Çπ${total.toLocaleString()} repair cost.`;
  document.getElementById('report-card').style.display='block';
  setStep(3);

  tlog('success',`Complete in ${scanSec}s ‚Äî Score: ${data.sev} | PCI: ${data.pci}`);
  btn.disabled=false;btn.innerHTML='üî¨ &nbsp; RE-ANALYZE';
  addXP(25,'Scan complete! üîç');
}

function showRepairBreakdown(repair,sev){
  const total=Object.values(repair).reduce((a,b)=>a+b,0);
  if(total===0||sev<10){document.getElementById('repair-panel').style.display='none';return;}
  const rows=[['üîç Site Survey',repair.survey],['ü™® Materials (Asphalt)',repair.material],['üë∑ Labour & Crew',repair.labour],['üöß Machinery',repair.machinery],['üìã Misc',repair.misc]];
  document.getElementById('repair-breakdown').innerHTML=rows.map(([l,v])=>`<div class="rb-row"><span class="rb-label">${l}</span><span class="rb-cost">‚Çπ${v.toLocaleString()}</span></div>`).join('')+`<div class="rb-row rb-total"><span class="rb-label">üí∞ Total Estimate</span><span class="rb-cost">‚Çπ${total.toLocaleString()}</span></div>`;
  document.getElementById('repair-panel').style.display='block';
}

function showTips(tips){
  document.getElementById('tips-list').innerHTML=tips.map(t=>`<div class="tip-item"><span class="tip-icon">üí°</span><span class="tip-text">${t}</span></div>`).join('');
}

function drawDetections(data){
  clearBoxes();
  const wrap=document.getElementById('preview-wrap'),img=document.getElementById('preview-img');
  const W=img.offsetWidth,H=img.offsetHeight;
  const cfg={alligator:{c:'#ff3355',l:'Alligator'},pothole:{c:'#ff8c42',l:'Pothole'},longit:{c:'#ffdf00',l:'Long.Crack'},transverse:{c:'#a78bff',l:'Trans.Crack'},edge:{c:'#00e5a0',l:'Edge'}};
  let delay=0;
  Object.entries(data.types).forEach(([k,n])=>{
    if(!n)return;const{c,l}=cfg[k];
    for(let i=0;i<Math.min(n,3);i++){
      const bw=55+Math.random()*90,bh=40+Math.random()*70;
      const bx=18+Math.random()*(W-bw-36),by=H*0.12+Math.random()*(H*0.74-bh);
      const conf=Math.floor(85+Math.random()*14);
      const box=document.createElement('div');box.className='detect-box';
      box.style.cssText=`left:${bx}px;top:${by}px;width:${bw}px;height:${bh}px;border-color:${c};box-shadow:0 0 12px ${c}44;animation-delay:${delay*0.11}s`;
      const lbl=document.createElement('div');lbl.className='detect-label';lbl.style.cssText=`background:${c};color:#07080f`;lbl.textContent=l;
      const ce=document.createElement('div');ce.className='detect-conf';ce.textContent=conf+'%';
      const pulse=document.createElement('div');pulse.className='detect-pulse';pulse.style.cssText=`border-color:${c};animation-delay:${delay*0.11+0.25}s`;
      box.appendChild(lbl);box.appendChild(ce);box.appendChild(pulse);wrap.appendChild(box);delay++;
    }
  });
}
function clearBoxes(){document.querySelectorAll('.detect-box').forEach(e=>e.remove());}

function animateScore(target,label){
  const el=document.getElementById('score-num'),circle=document.getElementById('score-circle'),verdict=document.getElementById('score-verdict');
  let cur=0;
  const t=setInterval(()=>{cur=Math.min(cur+target/50,target);el.textContent=Math.round(cur);circle.style.strokeDashoffset=345-(345*Math.round(cur)/100);if(cur>=target)clearInterval(t);},22);
  verdict.textContent=label==='GOOD'?'Road in Excellent Condition':'Damage Level: '+label;
  const col=getScoreColor(target);el.style.background=`linear-gradient(135deg,${col},${col}99)`;el.style['-webkit-background-clip']='text';el.style.webkitTextFillColor='transparent';
}
function getScoreColor(s){return s>=80?'#ff3355':s>=60?'#ff8c42':s>=40?'#ffdf00':'#00e5a0';}

function resetMetrics(){
  document.getElementById('score-num').textContent='--';document.getElementById('score-verdict').textContent='Awaiting Scan';document.getElementById('score-circle').style.strokeDashoffset=345;
  const up=document.getElementById('urgency-pill');up.textContent='‚Äî Upload a road image ‚Äî';up.style.background='rgba(122,138,170,0.1)';up.style.borderColor='rgba(122,138,170,0.3)';up.style.color='var(--dim)';
  ['m-coverage','m-defects','m-pci','m-conf','m-scantime','m-road-age'].forEach(id=>{const el=document.getElementById(id);if(el)el.textContent='--';});
  ['alligator','pothole','longit','transverse','edge'].forEach(k=>{document.getElementById('dt-'+k).classList.remove('active');document.getElementById('cnt-'+k).textContent='0';const b=document.querySelector('#dt-'+k+' .d-bar');if(b)b.style.width='0%';});
  document.getElementById('tips-list').innerHTML='<div class="tip-item"><span class="tip-icon">üí°</span><span class="tip-text">AI insights will appear here after analysis.</span></div>';
}
function randScenario(){const k=Object.keys(S).filter(k=>k!=='good');return S[k[Math.floor(Math.random()*k.length)]];}

// LOCATION
function getLocation(){
  const btn=document.getElementById('loc-btn');btn.textContent='üì° Detecting...';btn.disabled=true;
  document.getElementById('loc-status').textContent='Requesting GPS...';document.getElementById('loc-status').style.color='var(--neon3)';
  if(!navigator.geolocation){useFallback();return;}
  navigator.geolocation.getCurrentPosition(p=>onGotLoc(p.coords.latitude,p.coords.longitude,p.coords.accuracy),()=>{tlog('warn','GPS denied ‚Äî using region estimate');useFallback();},{enableHighAccuracy:true,timeout:8000});
}
function useFallback(){onGotLoc(20.0856,75.6583,200,'Estimated');}
function onGotLoc(lat,lng,acc,method='GPS'){
  locationData={lat,lng,acc};
  const now=new Date();
  document.getElementById('loc-lat').textContent=lat.toFixed(5)+'¬∞';
  document.getElementById('loc-lng').textContent=lng.toFixed(5)+'¬∞';
  document.getElementById('loc-acc').textContent='¬±'+Math.round(acc)+'m';
  document.getElementById('loc-status').textContent=method+' ‚úì';document.getElementById('loc-status').style.color='var(--green)';
  document.getElementById('loc-time').textContent=now.toLocaleTimeString('en-IN');
  fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json`).then(r=>r.json()).then(d=>{const a=d.display_name?d.display_name.split(',').slice(0,3).join(', '):'Maharashtra, IN';document.getElementById('loc-area').textContent=a;tlog('success','Location: '+a);}).catch(()=>document.getElementById('loc-area').textContent='Maharashtra, IN');
  document.getElementById('mini-map').style.display='block';
  document.getElementById('map-iframe').src=`https://www.openstreetmap.org/export/embed.html?bbox=${lng-0.005},${lat-0.005},${lng+0.005},${lat+0.005}&layer=mapnik&marker=${lat},${lng}`;
  fetchWeather(lat,lng);setStep(3);
  const btn=document.getElementById('loc-btn');btn.textContent='‚úÖ Captured';btn.disabled=false;btn.style.color='var(--green)';btn.style.borderColor='rgba(0,229,160,0.3)';
  tlog('data',`Coords: ${lat.toFixed(5)}, ${lng.toFixed(5)} ¬±${Math.round(acc)}m`);addXP(15,'Location tagged! üìç');
}

// WEATHER
function fetchWeather(lat,lng){
  fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current=temperature_2m,relative_humidity_2m,wind_speed_10m,visibility,weather_code&wind_speed_unit=kmh`)
  .then(r=>r.json()).then(d=>{
    const c=d.current,temp=Math.round(c.temperature_2m),hum=c.relative_humidity_2m,wind=Math.round(c.wind_speed_10m),vis=Math.round((c.visibility||10000)/1000);
    const{icon,desc}=getWI(c.weather_code);
    document.getElementById('w-icon').textContent=icon;document.getElementById('w-temp').textContent=temp+'¬∞C';
    document.getElementById('w-city').textContent=document.getElementById('loc-area').textContent||'Your Location';
    document.getElementById('w-desc').textContent=desc;
    document.getElementById('w-humidity').textContent=hum+'%';document.getElementById('w-wind').textContent=wind;document.getElementById('w-vis').textContent=vis+'km';
    document.getElementById('nav-weather').textContent=temp+'¬∞C';
    const imp=getRoadImpact(temp,hum,c.weather_code);
    document.getElementById('w-impact').innerHTML=`<span>${imp.icon}</span><span>${imp.msg}</span>`;
    window._wd={temp,hum,wind,vis,icon,desc,wc:c.weather_code,lat,lng};
    tlog('success',`Weather: ${temp}¬∞C, ${desc}`);
  }).catch(()=>{
    document.getElementById('w-icon').textContent='‚òÄÔ∏è';document.getElementById('w-temp').textContent='32¬∞C';
    document.getElementById('w-city').textContent='Maharashtra, IN';document.getElementById('w-desc').textContent='Sunny';
    document.getElementById('w-humidity').textContent='65%';document.getElementById('w-wind').textContent='14';document.getElementById('w-vis').textContent='10km';
    document.getElementById('nav-weather').textContent='32¬∞C';
    document.getElementById('w-impact').innerHTML='<span>‚òÄÔ∏è</span><span>Clear conditions ‚Äî <b>ideal for road repair today.</b></span>';
  });
}
function getWI(code){
  if(code===0)return{icon:'‚òÄÔ∏è',desc:'Clear Sky'};if(code<=3)return{icon:'‚õÖ',desc:'Partly Cloudy'};
  if(code<=49)return{icon:'üå´Ô∏è',desc:'Foggy'};if(code<=69)return{icon:'üåßÔ∏è',desc:'Rainy'};
  if(code<=79)return{icon:'‚ùÑÔ∏è',desc:'Snowy'};if(code<=82)return{icon:'üå¶Ô∏è',desc:'Rain Showers'};
  if(code<=99)return{icon:'‚õàÔ∏è',desc:'Thunderstorm'};return{icon:'üå§Ô∏è',desc:'Overcast'};
}
function getRoadImpact(temp,hum,code){
  if(code>=61&&code<=82)return{icon:'üö®',msg:'<b>Rain detected!</b> Cracks worsen 3x faster. Urgent repair!'};
  if(hum>80)return{icon:'‚ö†Ô∏è',msg:'<b>High humidity</b> accelerates crack growth. Repair within 2 weeks.'};
  if(temp>38)return{icon:'üå°Ô∏è',msg:'<b>Extreme heat</b> softens asphalt ‚Äî avoid heavy loads till evening.'};
  if(temp<10)return{icon:'‚ùÑÔ∏è',msg:'<b>Cold weather</b> worsens transverse cracks via thermal contraction.'};
  return{icon:'‚úÖ',msg:'<b>Good conditions</b> for road repair. Ideal temperature & visibility today.'};
}
function openWeatherModal(){
  const d=window._wd||{temp:32,hum:65,wind:14,vis:10,icon:'‚òÄÔ∏è',desc:'Sunny',lat:20.09,lng:75.66};
  document.getElementById('modal-weather-content').innerHTML=`
    <div style="text-align:center;margin-bottom:1.4rem;">
      <div style="font-size:4.5rem;margin-bottom:0.5rem;">${d.icon}</div>
      <div style="font-family:'Orbitron',monospace;font-size:2rem;font-weight:900;color:var(--blue);">${d.temp}¬∞C</div>
      <div style="color:var(--dim);margin-top:0.3rem;">${d.desc}</div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:0.7rem;margin-bottom:1rem;">
      <div class="w-item"><div class="w-val">${d.hum}%</div><div class="w-lbl">Humidity</div></div>
      <div class="w-item"><div class="w-val">${d.wind}km/h</div><div class="w-lbl">Wind</div></div>
      <div class="w-item"><div class="w-val">${d.vis}km</div><div class="w-lbl">Visibility</div></div>
    </div>
    <div class="weather-impact">${document.getElementById('w-impact').innerHTML}</div>
    <div style="margin-top:0.9rem;font-size:0.75rem;color:var(--dim);text-align:center;">üìç ${d.lat.toFixed(4)}¬∞, ${d.lng.toFixed(4)}¬∞ ¬∑ Open-Meteo</div>`;
  document.getElementById('weather-modal').classList.add('show');
}
function closeWeatherModal(){document.getElementById('weather-modal').classList.remove('show');}

// REPORT
function submitReport(){
  if(!analysisResult){tlog('warn','Run analysis first!');return;}
  const btn=document.getElementById('submit-btn');btn.textContent='‚è≥ Submitting...';btn.disabled=true;
  setTimeout(()=>{
    const ref=document.getElementById('report-id').textContent;
    document.getElementById('success-ref').textContent=ref;
    showConfetti();document.getElementById('success-overlay').classList.add('show');
    addXP(150,'Road damage reported! üö®');
    myReports++;myDefects+=Object.values(analysisResult.types).reduce((a,b)=>a+b,0);
    document.getElementById('stat-reports').textContent=myReports;
    document.getElementById('stat-defects').textContent=myDefects;
    document.getElementById('stat-rank').textContent='#'+Math.floor(Math.random()*50+1);
    setStep(4);addToHistory();
    tlog('success','‚úì Submitted to Municipal Corporation');tlog('data',ref);
    btn.textContent='‚úÖ Submitted!';
  },1600);
}

function exportData(){
  if(!analysisResult)return;
  const s=analysisResult,loc=locationData?`${locationData.lat.toFixed(5)},${locationData.lng.toFixed(5)}`:'Not captured';
  const repair=Object.values(s.repair||{}).reduce((a,b)=>a+b,0);
  const csv=['Field,Value',`Report ID,${document.getElementById('report-id').textContent}`,`Timestamp,${new Date().toISOString()}`,`Severity,${s.sev}`,`Level,${s.lbl}`,`Coverage %,${s.cov}`,`PCI,${s.pci}`,`Alligator,${s.types.alligator}`,`Potholes,${s.types.pothole}`,`Longitudinal,${s.types.longit}`,`Transverse,${s.types.transverse}`,`Edge,${s.types.edge}`,`AI Confidence,${s.conf}%`,`Est. Road Age,${s.age}`,`Est. Repair Cost,‚Çπ${repair.toLocaleString()}`,`Days to Fix,${s.days}`,`GPS,${loc}`,`Location,${document.getElementById('loc-area').textContent||'Unknown'}`,`Weather,${document.getElementById('w-temp').textContent} ${document.getElementById('w-desc').textContent}`,`Field Notes,${document.getElementById('field-notes').value||'None'}`].join('\n');
  const a=document.createElement('a');a.href='data:text/csv;charset=utf-8,'+encodeURIComponent(csv);a.download=`sustainx-${Date.now()}.csv`;a.click();
  addXP(20,'Data exported! üìä');tlog('success','CSV exported');
}

function shareReport(){
  if(!analysisResult)return;
  const s=analysisResult,area=document.getElementById('loc-area').textContent||'Unknown Location';
  const repair=Object.values(s.repair||{}).reduce((a,b)=>a+b,0);
  const text=`üö® Road Damage Alert!\nüìç ${area}\n‚ö†Ô∏è Severity: ${s.sev}/100 (${s.lbl})\n${Object.values(s.types).reduce((a,b)=>a+b,0)} defects detected\nüí∞ Est. repair: ‚Çπ${repair.toLocaleString()}\n${document.getElementById('report-id').textContent}\n\nReported via SustainX üåø #FixOurRoads`;
  if(navigator.share)navigator.share({title:'Road Damage Report',text});
  else navigator.clipboard.writeText(text).then(()=>{addXP(10,'Shared!');tlog('success','Copied to clipboard!');});
}

function downloadAnnotated(){
  const img=document.getElementById('preview-img');
  const c=document.createElement('canvas');c.width=img.naturalWidth||img.offsetWidth;c.height=img.naturalHeight||img.offsetHeight;
  const ctx=c.getContext('2d');ctx.drawImage(img,0,0,c.width,c.height);
  ctx.fillStyle='rgba(0,255,204,0.9)';ctx.fillRect(10,10,300,32);
  ctx.fillStyle='#07080f';ctx.font='bold 14px monospace';ctx.fillText('SustainX Road Damage Analysis',18,31);
  const a=document.createElement('a');a.href=c.toDataURL('image/png');a.download='sustainx-annotated.png';a.click();
  tlog('success','Annotated image saved');
}

function addNote(text){const ta=document.getElementById('field-notes');ta.value=(ta.value?ta.value+'\n':'')+text;}

// GAMIFICATION
function addXP(amount,reason){
  totalXP+=amount;
  document.getElementById('total-xp').textContent=totalXP;
  document.getElementById('xp-cur').textContent=totalXP;
  document.getElementById('xp-bar').style.width=Math.min((totalXP/500)*100,100)+'%';
  const lvl=totalXP<100?1:totalXP<250?2:totalXP<500?3:4;
  document.getElementById('xp-level').textContent=lvl;
  if(lvl>=2){const b=document.getElementById('badge-hunter');b.classList.remove('locked');b.classList.add('earned');}
  if(lvl>=3){const b=document.getElementById('badge-warrior');b.classList.remove('locked');b.classList.add('earned');}
  if(lvl>=4){const b=document.getElementById('badge-legend');b.classList.remove('locked');b.classList.add('earned');}
  document.getElementById('xp-amount').textContent='+'+amount+' XP';document.getElementById('xp-reason').textContent=reason;
  const t=document.getElementById('xp-toast');t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3200);
}

function showConfetti(){
  const wrap=document.getElementById('confetti-wrap');wrap.innerHTML='';
  const cols=['#00ffcc','#ff6bff','#ffbe00','#ff4466','#00b8ff','#a78bff'];
  for(let i=0;i<70;i++){const p=document.createElement('div');p.className='confetti-piece';const sx=(Math.random()-0.5)*160,ex=(Math.random()-0.5)*320;p.style.cssText=`left:${15+Math.random()*70}%;top:0;background:${cols[Math.floor(Math.random()*cols.length)]};--dur:${1.4+Math.random()*1.8}s;--delay:${Math.random()*0.7}s;--sx:${sx}px;--ex:${ex}px;width:${5+Math.random()*7}px;height:${5+Math.random()*7}px;border-radius:${Math.random()>0.5?'50%':'2px'};`;wrap.appendChild(p);}
}
function closeSuccess(){document.getElementById('success-overlay').classList.remove('show');}

function addToHistory(){
  if(!analysisResult)return;const s=analysisResult,col=getScoreColor(s.sev);
  const icons={alligator:'üêä',pothole:'üï≥Ô∏è',longit:'üìè',transverse:'‚ÜîÔ∏è',edge:'‚óªÔ∏è',good:'‚úÖ'};
  const top=Object.entries(s.types).sort((a,b)=>b[1]-a[1])[0];const icon=top&&top[1]>0?icons[top[0]]:'‚úÖ';
  const loc=document.getElementById('loc-area').textContent||'Maharashtra, IN';const tot=Object.values(s.types).reduce((a,b)=>a+b,0);
  const el=document.createElement('div');el.className='history-item';el.style.borderColor='rgba(0,255,204,0.2)';
  el.innerHTML=`<div class="h-top"><span class="h-icon">${icon}</span><div><div class="h-name">My Report ‚ú®</div><div class="h-date">üìç ${loc.split(',').slice(0,2).join(',')} ¬∑ Just now</div></div></div><div class="h-bar" style="background:linear-gradient(90deg,${col},${col}44);width:${s.sev}%"></div><div class="h-meta"><span>${tot} defects</span><span class="h-score" style="background:${col}1a;color:${col}">Score: ${s.sev}</span></div>`;
  document.getElementById('history-grid').prepend(el);
}

// UTILS
function setStep(n){['chip-1','chip-2','chip-3','chip-4'].forEach((id,i)=>{const el=document.getElementById(id);el.classList.remove('active','done');if(i+1<n)el.classList.add('done');else if(i+1===n)el.classList.add('active');});}
function tlog(type,msg){const body=document.getElementById('term-body'),sec=((Date.now()-tStart)/1000).toFixed(2).padStart(6,'0');const line=document.createElement('div');line.className='t-line';line.innerHTML=`<span class="t-time">${sec}</span><span class="t-msg ${type}">${msg}</span>`;body.appendChild(line);body.scrollTop=body.scrollHeight;}
function toggleZoom(){const img=document.getElementById('preview-img');img.style.maxHeight=img.style.maxHeight==='none'?'420px':'none';}
function startCamera(){const inp=document.createElement('input');inp.type='file';inp.accept='image/*';inp.capture='environment';inp.onchange=()=>{if(inp.files[0])handleFile(inp.files[0]);};inp.click();addXP(10,'Camera opened! üì∏');}
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}

// Auto-load weather for Sillod on startup
setTimeout(()=>{
  fetch('https://api.open-meteo.com/v1/forecast?latitude=20.09&longitude=75.66&current=temperature_2m,relative_humidity_2m,wind_speed_10m,visibility,weather_code&wind_speed_unit=kmh')
  .then(r=>r.json()).then(d=>{
    const c=d.current,temp=Math.round(c.temperature_2m),hum=c.relative_humidity_2m,wind=Math.round(c.wind_speed_10m),vis=Math.round((c.visibility||10000)/1000);
    const{icon,desc}=getWI(c.weather_code);
    document.getElementById('w-icon').textContent=icon;document.getElementById('w-temp').textContent=temp+'¬∞C';
    document.getElementById('w-city').textContent='Sillod, Maharashtra';document.getElementById('w-desc').textContent=desc;
    document.getElementById('w-humidity').textContent=hum+'%';document.getElementById('w-wind').textContent=wind;document.getElementById('w-vis').textContent=vis+'km';
    document.getElementById('nav-weather').textContent=temp+'¬∞C';
    const imp=getRoadImpact(temp,hum,c.weather_code);document.getElementById('w-impact').innerHTML=`<span>${imp.icon}</span><span>${imp.msg}</span>`;
    window._wd={temp,hum,wind,vis,icon,desc,wc:c.weather_code,lat:20.09,lng:75.66};
  }).catch(()=>{
    document.getElementById('w-icon').textContent='‚òÄÔ∏è';document.getElementById('w-temp').textContent='32¬∞C';
    document.getElementById('w-city').textContent='Sillod, Maharashtra';document.getElementById('w-desc').textContent='Sunny';
    document.getElementById('w-humidity').textContent='65%';document.getElementById('w-wind').textContent='14';document.getElementById('w-vis').textContent='10km';
    document.getElementById('nav-weather').textContent='32¬∞C';
    document.getElementById('w-impact').innerHTML='<span>‚òÄÔ∏è</span><span>Clear conditions ‚Äî <b>great for road inspection!</b></span>';
  });
},600);
</script>
</body>
</html>